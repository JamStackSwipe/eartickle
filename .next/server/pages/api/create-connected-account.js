"use strict";(()=>{var e={};e.id=156,e.ids=[156],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3610:e=>{e.exports=import("@vercel/postgres")},6090:e=>{e.exports=import("stripe")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,o){return o in t?t[o]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,o)):"function"==typeof t&&"default"===o?t:void 0}}})},5504:(e,t,o)=>{o.a(e,async(e,r)=>{try{o.r(t),o.d(t,{config:()=>l,default:()=>u,routeModule:()=>d});var n=o(1802),s=o(7153),c=o(6249),i=o(708),a=e([i]);i=(a.then?(await a)():a)[0];let u=(0,c.l)(i,"default"),l=(0,c.l)(i,"config"),d=new n.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/create-connected-account",pathname:"/api/create-connected-account",bundlePath:"",filename:""},userland:i});r()}catch(e){r(e)}})},708:(e,t,o)=>{o.a(e,async(e,r)=>{try{o.r(t),o.d(t,{default:()=>i});var n=o(6090),s=o(3610),c=e([n,s]);[n,s]=c.then?(await c)():c;let a=new n.default(process.env.STRIPE_SECRET_KEY??"");async function i(e,t){if(console.log("\uD83D\uDD25 API HIT: create-connected-account"),"POST"!==e.method)return console.log("❌ Wrong method"),t.status(405).json({error:"Method not allowed"});let{user_id:o}=e.body;if(console.log("\uD83D\uDD0D Received user_id:",o),!o)return console.log("❌ Missing user_id"),t.status(400).json({error:"Missing user_id"});try{let{rows:r}=await (0,s.sql)`
      SELECT stripe_account_id
      FROM profiles
      WHERE id = ${o}
    `;if(!r.length)return console.log("❌ User not found"),t.status(404).json({error:"User not found"});let n=r[0];console.log("✅ Found profile:",n);let c=n.stripe_account_id;c?console.log("✅ Existing Stripe account found:",c):(console.log("\uD83C\uDD95 Creating new Stripe Express account..."),c=(await a.accounts.create({type:"express"})).id,await (0,s.sql)`
        UPDATE profiles
        SET stripe_account_id = ${c}
        WHERE id = ${o}
      `,console.log("✅ Stripe account ID saved:",c));let i=await a.accountLinks.create({account:c,refresh_url:`${e.headers.origin}/profile?setup=true`,return_url:`${e.headers.origin}/profile?setup=complete`,type:"account_onboarding"});return t.status(200).json({success:!0,accountId:c,onboardUrl:i.url})}catch(e){return console.error("❌ Stripe/DB error:",e),t.status(500).json({error:"Failed to create connected account"})}}r()}catch(e){r(e)}})},7153:(e,t)=>{var o;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return o}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(o||(o={}))},1802:(e,t,o)=>{e.exports=o(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var o=t(t.s=5504);module.exports=o})();