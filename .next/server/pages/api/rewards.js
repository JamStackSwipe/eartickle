"use strict";(()=>{var e={};e.id=308,e.ids=[308],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3610:e=>{e.exports=import("@vercel/postgres")},6090:e=>{e.exports=import("stripe")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},9396:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>d,default:()=>u,routeModule:()=>p});var n=r(1802),c=r(7153),s=r(6249),i=r(2376),o=e([i]);i=(o.then?(await o)():o)[0];let u=(0,s.l)(i,"default"),d=(0,s.l)(i,"config"),p=new n.PagesAPIRouteModule({definition:{kind:c.x.PAGES_API,page:"/api/rewards",pathname:"/api/rewards",bundlePath:"",filename:""},userland:i});a()}catch(e){a(e)}})},2376:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{createConnectedAccount:()=>u,createTickleCheckoutSession:()=>d,default:()=>i});var n=r(6090),c=r(3610),s=e([n,c]);[n,c]=s.then?(await s)():s;let o=new n.default(process.env.STRIPE_SECRET_KEY,{apiVersion:"2022-11-15"}),u=async(e,t)=>{try{let r=await o.accounts.create({type:"express",email:t,metadata:{userId:e}}),a=await o.accountLinks.create({account:r.id,refresh_url:`${process.env.NEXT_PUBLIC_SITE_URL||"https://eartickle.com"}/settings`,return_url:`${process.env.NEXT_PUBLIC_SITE_URL||"https://eartickle.com"}/settings`,type:"account_onboarding"});return await (0,c.sql)`
      UPDATE profiles 
      SET stripe_account_id = ${r.id}
      WHERE id = ${e}
    `,{url:a.url,accountId:r.id}}catch(e){return console.error("Stripe Connect Error:",e),{error:e.message}}},d=async({artistStripeId:e,songId:t,songTitle:r,senderId:a,artistId:n,amountCents:s=500})=>{try{let i=await o.checkout.sessions.create({payment_method_types:["card"],line_items:[{price_data:{currency:"usd",unit_amount:s,product_data:{name:`ðŸŽ Tickle for "${r}"`,metadata:{songId:t,artistId:n,senderId:a}}},quantity:1}],mode:"payment",success_url:`${process.env.NEXT_PUBLIC_SITE_URL||"https://eartickle.com"}/rewards?success=1`,cancel_url:`${process.env.NEXT_PUBLIC_SITE_URL||"https://eartickle.com"}/rewards?canceled=1`,metadata:{songId:t,artistId:n,senderId:a,amountCents:s,type:"tickle_purchase"},payment_intent_data:{application_fee_amount:Math.floor(.1*s),transfer_data:{destination:e}}});return await (0,c.sql)`
      INSERT INTO tickle_transactions (sender_id, receiver_id, song_id, amount, stripe_payment_id)
      VALUES (${a}, ${n}, ${t}, ${Math.floor(s/100)}, ${i.id})
    `,{url:i.url}}catch(e){return console.error("Stripe Checkout Error:",e),{error:e.message}}};async function i(e,t){t.status(200).json({message:"This is a helper module. Use /api/create-connected-account or /api/create-tickle-checkout instead."})}a()}catch(e){a(e)}})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=9396);module.exports=r})();