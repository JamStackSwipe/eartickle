"use strict";(()=>{var e={};e.id=650,e.ids=[650,660],e.modules={6542:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{config:()=>h,default:()=>x,getServerSideProps:()=>p,getStaticPaths:()=>m,getStaticProps:()=>f,reportWebVitals:()=>b,routeModule:()=>w,unstable_getServerProps:()=>v,unstable_getServerSideProps:()=>j,unstable_getStaticParams:()=>y,unstable_getStaticPaths:()=>g,unstable_getStaticProps:()=>D});var a=s(7093),l=s(5244),i=s(1323),n=s(2899),u=s.n(n),c=s(3414),o=s(6869),d=e([o]);o=(d.then?(await d)():d)[0];let x=(0,i.l)(o,"default"),f=(0,i.l)(o,"getStaticProps"),m=(0,i.l)(o,"getStaticPaths"),p=(0,i.l)(o,"getServerSideProps"),h=(0,i.l)(o,"config"),b=(0,i.l)(o,"reportWebVitals"),D=(0,i.l)(o,"unstable_getStaticProps"),g=(0,i.l)(o,"unstable_getStaticPaths"),y=(0,i.l)(o,"unstable_getStaticParams"),v=(0,i.l)(o,"unstable_getServerProps"),j=(0,i.l)(o,"unstable_getServerSideProps"),w=new a.PagesRouteModule({definition:{kind:l.x.PAGES,page:"/charts",pathname:"/charts",bundlePath:"",filename:""},components:{App:c.default,Document:u()},userland:o});r()}catch(e){r(e)}})},6869:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{default:()=>c});var a=s(997),l=s(2813),i=s(6252),n=s(8212),u=e([n]);function c(){return(0,a.jsxs)("div",{className:"app flex flex-col min-h-screen",children:[a.jsx(l.Z,{}),a.jsx("main",{className:"main-content flex-grow",children:a.jsx(n.Z,{})}),a.jsx(i.Z,{})]})}n=(u.then?(await u)():u)[0],r()}catch(e){r(e)}})},3510:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.d(t,{Z:()=>p});var a=s(997),l=s(6689),i=s(9332),n=s(1842),u=s(6201),c=s(3146),o=s(3322),d=s(9314),x=e([u,c,o]);[u,c,o]=x.then?(await x)():x,new Audio("/sounds/tickle.mp3");let f=e=>{switch(e){case"\uD83D\uDD25":return"fires";case"\uD83D\uDC96":return"loves";case"\uD83D\uDE2D":return"sads";case"\uD83C\uDFAF":return"bullseyes";default:return""}},m=e=>{switch(e){case"fire":return"\uD83D\uDD25";case"heart":return"\uD83D\uDC96";case"cry":return"\uD83D\uDE2D";case"bullseye":return"\uD83C\uDFAF";default:return""}},p=({song:e,user:t})=>{if(e.is_draft||!e.cover||!e.audio)return null;let s=(0,i.useRouter)(),[r,u]=(0,l.useState)({fires:e.fires||0,loves:e.loves||0,sads:e.sads||0,bullseyes:e.bullseyes||0}),[x,p]=(0,l.useState)({fires:!1,loves:!1,sads:!1,bullseyes:!1}),h=(0,l.useRef)(null),b=(0,l.useRef)(null),[D,g]=(0,l.useState)(!1),y=d.x[e.genre_flavor]||null,v=y?`ring-4 ring-${y.color}-500`:"";y&&y.color,(0,l.useEffect)(()=>{let e=new IntersectionObserver(([e])=>g(e.isIntersecting),{threshold:.5});return b.current&&e.observe(b.current),()=>e.disconnect()},[]),(0,l.useEffect)(()=>{h.current&&(D?(h.current.play().catch(()=>{}),j()):h.current.pause())},[D]),(0,l.useEffect)(()=>{(async()=>{try{let[s,r]=await Promise.all([n.O.from("songs").select("fires, loves, sads, bullseyes, jams").eq("id",e.id).single(),t?n.O.from("reactions").select("emoji").eq("user_id",t.id).eq("song_id",e.id):{data:[]}]);if(s.data&&u({fires:s.data.fires||0,loves:s.data.loves||0,sads:s.data.sads||0,bullseyes:s.data.bullseyes||0}),r.data?.length>0){let e={};for(let t of r.data)e[f(m(t.emoji))]=!0;p(e)}}catch(e){console.error("❌ Stats/reactions fetch error:",e)}})()},[t,e.id]);let j=async()=>{try{await n.O.rpc("increment_song_view",{song_id_input:e.id})}catch(e){console.error("❌ View increment error:",e)}};return(0,a.jsxs)("div",{ref:b,"data-song-id":e.id,className:`bg-zinc-900 text-white w-full max-w-md mx-auto mb-10 p-4 rounded-xl shadow-md transition-all ${y?"hover:animate-genre-pulse":""} ${v}`,style:y?{boxShadow:`0 0 15px ${(e=>{switch(e){case"amber":return"#f59e0b";case"blue":return"#3b82f6";case"pink":return"#ec4899";case"purple":return"#a855f7";case"cyan":return"#06b6d4";case"red":return"#ef4444";default:return"#ffffff"}})(y.color)}`}:{},children:[(0,a.jsxs)("div",{className:"relative",children:[a.jsx("a",{href:`/artist/${e.artist_id}`,onClick:t=>{t.preventDefault(),j().finally(()=>{s.push(`/artist/${e.artist_id}`)})},className:"block",children:a.jsx("img",{src:e.cover,alt:e.title,className:"w-full h-auto rounded-xl mb-4"})}),y&&a.jsx("div",{className:`absolute top-2 left-2 bg-${y.color}-600 text-white text-xs font-bold px-2 py-1 rounded shadow`,children:y.label})]}),a.jsx("h2",{className:"text-xl font-semibold mb-1",children:e.title}),(0,a.jsxs)("p",{className:"text-sm text-gray-400 mb-2",children:["by ",e.artist]}),t&&a.jsx("div",{className:"mt-3 flex justify-center",children:a.jsx(o.Z,{songId:e.id,userId:t.id})}),a.jsx("audio",{ref:h,src:e.audio,controls:!0,className:"w-full mb-3 mt-2"}),a.jsx(c.Z,{song:{...e,user_id:e.artist_id}})]})};r()}catch(e){r(e)}})},8212:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.d(t,{Z:()=>d});var a=s(997),l=s(6689),i=s(3510),n=s(2364),u=e([i]);i=(u.then?(await u)():u)[0];let c=[{key:"views",label:"\uD83D\uDD25 Top"},{key:"loves",label:"❤️ Loved"},{key:"fires",label:"\uD83D\uDD25 Fire"},{key:"bullseyes",label:"\uD83C\uDFAF Bullseye"},{key:"sads",label:"\uD83D\uDE22 Sad"},{key:"jams",label:"\uD83D\uDCE5 Jammed"},{key:"tickles",label:"\uD83C\uDF81 Tickled"}],o={views:"\uD83D\uDD25",loves:"❤️",fires:"\uD83D\uDD25",bullseyes:"\uD83C\uDFAF",sads:"\uD83D\uDE22",jams:"\uD83D\uDCE5",tickles:"\uD83C\uDF81"},d=()=>{let{user:e}=(0,n.a)(),[t,s]=(0,l.useState)([]),[r,u]=(0,l.useState)(!0),[d,x]=(0,l.useState)("views");return(0,l.useEffect)(()=>{(async()=>{u(!0);try{let e=await fetch(`/api/charts/top?filter=${d}&limit=20`);if(!e.ok)throw Error("Failed to fetch chart songs");let t=await e.json();s(t)}catch(e){console.error("Error fetching chart songs:",e.message),s([])}u(!1)})()},[d]),(0,a.jsxs)("div",{className:"p-4 max-w-xl mx-auto",children:[(0,a.jsxs)("h1",{className:"text-2xl font-bold mb-6 text-zinc-900 text-center",children:[o[d]," ",d.charAt(0).toUpperCase()+d.slice(1)," Top 20 Chart"]}),a.jsx("div",{className:"flex flex-wrap justify-center gap-2 mb-4",children:c.map(e=>a.jsx("button",{onClick:()=>x(e.key),className:`px-3 py-1 text-sm rounded-full font-semibold transition-colors duration-150 ${d===e.key?"bg-blue-600 text-white":"bg-gray-200 text-gray-800 dark:bg-zinc-700 dark:text-white"}`,children:e.label},e.key))}),r?a.jsx("div",{className:"text-center text-white",children:"Loading songs..."}):a.jsx("div",{className:"space-y-6",children:t.map((t,s)=>a.jsx(i.Z,{song:t,user:e,rank:s+1,filter:d},t.id))})]})};r()}catch(e){r(e)}})},2885:e=>{e.exports=require("@supabase/supabase-js")},2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},1568:e=>{e.exports=require("zlib")},6201:e=>{e.exports=import("react-hot-toast")}};var t=require("../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[899,910,332,206],()=>s(6542));module.exports=r})();