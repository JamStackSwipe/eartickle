"use strict";(()=>{var e={};e.id=482,e.ids=[482,660],e.modules={3396:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{config:()=>p,default:()=>m,getServerSideProps:()=>h,getStaticPaths:()=>f,getStaticProps:()=>x,reportWebVitals:()=>g,routeModule:()=>D,unstable_getServerProps:()=>j,unstable_getServerSideProps:()=>w,unstable_getStaticParams:()=>y,unstable_getStaticPaths:()=>v,unstable_getStaticProps:()=>b});var a=s(7093),n=s(5244),l=s(1323),i=s(2899),c=s.n(i),o=s(3414),u=s(1135),d=e([u]);u=(d.then?(await d)():d)[0];let m=(0,l.l)(u,"default"),x=(0,l.l)(u,"getStaticProps"),f=(0,l.l)(u,"getStaticPaths"),h=(0,l.l)(u,"getServerSideProps"),p=(0,l.l)(u,"config"),g=(0,l.l)(u,"reportWebVitals"),b=(0,l.l)(u,"unstable_getStaticProps"),v=(0,l.l)(u,"unstable_getStaticPaths"),y=(0,l.l)(u,"unstable_getStaticParams"),j=(0,l.l)(u,"unstable_getServerProps"),w=(0,l.l)(u,"unstable_getServerSideProps"),D=new a.PagesRouteModule({definition:{kind:n.x.PAGES,page:"/jamstack",pathname:"/jamstack",bundlePath:"",filename:""},components:{App:o.default,Document:c()},userland:u});r()}catch(e){r(e)}})},1135:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{default:()=>o});var a=s(997),n=s(2813),l=s(6252),i=s(7192),c=e([i]);function o(){return(0,a.jsxs)("div",{className:"app flex flex-col min-h-screen",children:[a.jsx(n.Z,{}),a.jsx("main",{className:"main-content flex-grow",children:a.jsx(i.Z,{})}),a.jsx(l.Z,{})]})}i=(c.then?(await c)():c)[0],r()}catch(e){r(e)}})},3510:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.d(t,{Z:()=>h});var a=s(997),n=s(6689),l=s(9332),i=s(1842),c=s(6201),o=s(3146),u=s(3322),d=s(9314),m=e([c,o,u]);[c,o,u]=m.then?(await m)():m,new Audio("/sounds/tickle.mp3");let x=e=>{switch(e){case"\uD83D\uDD25":return"fires";case"\uD83D\uDC96":return"loves";case"\uD83D\uDE2D":return"sads";case"\uD83C\uDFAF":return"bullseyes";default:return""}},f=e=>{switch(e){case"fire":return"\uD83D\uDD25";case"heart":return"\uD83D\uDC96";case"cry":return"\uD83D\uDE2D";case"bullseye":return"\uD83C\uDFAF";default:return""}},h=({song:e,user:t})=>{if(e.is_draft||!e.cover||!e.audio)return null;let s=(0,l.useRouter)(),[r,c]=(0,n.useState)({fires:e.fires||0,loves:e.loves||0,sads:e.sads||0,bullseyes:e.bullseyes||0}),[m,h]=(0,n.useState)({fires:!1,loves:!1,sads:!1,bullseyes:!1}),p=(0,n.useRef)(null),g=(0,n.useRef)(null),[b,v]=(0,n.useState)(!1),y=d.x[e.genre_flavor]||null,j=y?`ring-4 ring-${y.color}-500`:"";y&&y.color,(0,n.useEffect)(()=>{let e=new IntersectionObserver(([e])=>v(e.isIntersecting),{threshold:.5});return g.current&&e.observe(g.current),()=>e.disconnect()},[]),(0,n.useEffect)(()=>{p.current&&(b?(p.current.play().catch(()=>{}),w()):p.current.pause())},[b]),(0,n.useEffect)(()=>{(async()=>{try{let[s,r]=await Promise.all([i.O.from("songs").select("fires, loves, sads, bullseyes, jams").eq("id",e.id).single(),t?i.O.from("reactions").select("emoji").eq("user_id",t.id).eq("song_id",e.id):{data:[]}]);if(s.data&&c({fires:s.data.fires||0,loves:s.data.loves||0,sads:s.data.sads||0,bullseyes:s.data.bullseyes||0}),r.data?.length>0){let e={};for(let t of r.data)e[x(f(t.emoji))]=!0;h(e)}}catch(e){console.error("❌ Stats/reactions fetch error:",e)}})()},[t,e.id]);let w=async()=>{try{await i.O.rpc("increment_song_view",{song_id_input:e.id})}catch(e){console.error("❌ View increment error:",e)}};return(0,a.jsxs)("div",{ref:g,"data-song-id":e.id,className:`bg-zinc-900 text-white w-full max-w-md mx-auto mb-10 p-4 rounded-xl shadow-md transition-all ${y?"hover:animate-genre-pulse":""} ${j}`,style:y?{boxShadow:`0 0 15px ${(e=>{switch(e){case"amber":return"#f59e0b";case"blue":return"#3b82f6";case"pink":return"#ec4899";case"purple":return"#a855f7";case"cyan":return"#06b6d4";case"red":return"#ef4444";default:return"#ffffff"}})(y.color)}`}:{},children:[(0,a.jsxs)("div",{className:"relative",children:[a.jsx("a",{href:`/artist/${e.artist_id}`,onClick:t=>{t.preventDefault(),w().finally(()=>{s.push(`/artist/${e.artist_id}`)})},className:"block",children:a.jsx("img",{src:e.cover,alt:e.title,className:"w-full h-auto rounded-xl mb-4"})}),y&&a.jsx("div",{className:`absolute top-2 left-2 bg-${y.color}-600 text-white text-xs font-bold px-2 py-1 rounded shadow`,children:y.label})]}),a.jsx("h2",{className:"text-xl font-semibold mb-1",children:e.title}),(0,a.jsxs)("p",{className:"text-sm text-gray-400 mb-2",children:["by ",e.artist]}),t&&a.jsx("div",{className:"mt-3 flex justify-center",children:a.jsx(u.Z,{songId:e.id,userId:t.id})}),a.jsx("audio",{ref:p,src:e.audio,controls:!0,className:"w-full mb-3 mt-2"}),a.jsx(o.Z,{song:{...e,user_id:e.artist_id}})]})};r()}catch(e){r(e)}})},7192:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.d(t,{Z:()=>o});var a=s(997),n=s(6689),l=s(2364),i=s(3510),c=e([i]);i=(c.then?(await c)():c)[0];let o=()=>{let{user:e}=(0,l.a)(),[t,s]=(0,n.useState)([]),[r,c]=(0,n.useState)(0),o=(0,n.useRef)(null),u=e=>[...e].sort(()=>Math.random()-.5);if((0,n.useEffect)(()=>{(async()=>{if(e?.id)try{let e=await fetch("/api/jamstack/get");if(!e.ok)throw Error("Failed to fetch JamStack");let t=(await e.json()).filter(e=>e?.audio_url);s(u(t)),c(0)}catch(e){console.error("❌ Error fetching JamStack:",e.message)}})()},[e?.id]),(0,n.useEffect)(()=>{let e=o.current;if(!e||!t[r]?.audio_url)return;e.pause(),e.load(),e.play().catch(()=>{});let s=()=>{c(e=>(e+1)%t.length)};return e.addEventListener("ended",s),()=>e.removeEventListener("ended",s)},[r,t]),!t.length)return(0,a.jsxs)("div",{className:"text-white text-center mt-10",children:["No songs in your JamStack yet.",a.jsx("br",{}),"Go add some from Swipe or Charts!"]});let d=t[r],m=[t[(r+1)%t.length],t[(r+2)%t.length],t[(r+3)%t.length]];return(0,a.jsxs)("div",{className:"p-4 max-w-xl mx-auto",children:[a.jsx(i.Z,{song:d,user:e,audioRef:o,autoPlay:!0},d.id),a.jsx("div",{className:"flex justify-center mt-4",children:a.jsx("button",{onClick:()=>c(e=>(e+1)%t.length),className:"px-4 py-2 text-white rounded hover:shadow-md transition",style:{backgroundColor:"#3FD6CD","--tw-bg-opacity":1},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#2CB9B0",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#3FD6CD",children:"\uD83C\uDFB5 Next Song \uD83C\uDFB5"})}),t.length>1&&(0,a.jsxs)("div",{className:"mt-8 bg-black/80 p-4 rounded-xl shadow-inner",children:[a.jsx("div",{className:"text-sm text-gray-300 text-center mb-2",children:"Up Next"}),a.jsx("div",{className:"space-y-2",children:m.map((e,s)=>(0,a.jsxs)("div",{onClick:()=>c((r+s+1)%t.length),className:"flex items-center gap-3 p-2 rounded-lg hover:bg-zinc-800 cursor-pointer transition",children:[a.jsx("img",{src:e?.cover_url||"/default-cover.png",alt:"cover",className:"w-12 h-12 object-cover rounded shadow ring-2 ring-[#00CEC8]"}),(0,a.jsxs)("div",{className:"text-white text-sm",children:[a.jsx("div",{className:"font-medium",children:e?.title||"Untitled"}),e?.artist&&(0,a.jsxs)("div",{className:"text-xs text-gray-400",children:["by ",e.artist]})]})]},e?.id||s))})]})]})};r()}catch(e){r(e)}})},2885:e=>{e.exports=require("@supabase/supabase-js")},2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},1568:e=>{e.exports=require("zlib")},6201:e=>{e.exports=import("react-hot-toast")}};var t=require("../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[899,910,332,206],()=>s(3396));module.exports=r})();