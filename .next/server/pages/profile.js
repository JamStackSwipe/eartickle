"use strict";(()=>{var e={};e.id=277,e.ids=[277,660],e.modules={8030:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{config:()=>x,default:()=>f,getServerSideProps:()=>g,getStaticPaths:()=>h,getStaticProps:()=>m,reportWebVitals:()=>p,routeModule:()=>_,unstable_getServerProps:()=>j,unstable_getServerSideProps:()=>w,unstable_getStaticParams:()=>v,unstable_getStaticPaths:()=>y,unstable_getStaticProps:()=>b});var r=a(7093),l=a(5244),i=a(1323),o=a(2899),n=a.n(o),d=a(3414),c=a(2820),u=e([c]);c=(u.then?(await u)():u)[0];let f=(0,i.l)(c,"default"),m=(0,i.l)(c,"getStaticProps"),h=(0,i.l)(c,"getStaticPaths"),g=(0,i.l)(c,"getServerSideProps"),x=(0,i.l)(c,"config"),p=(0,i.l)(c,"reportWebVitals"),b=(0,i.l)(c,"unstable_getStaticProps"),y=(0,i.l)(c,"unstable_getStaticPaths"),v=(0,i.l)(c,"unstable_getStaticParams"),j=(0,i.l)(c,"unstable_getServerProps"),w=(0,i.l)(c,"unstable_getServerSideProps"),_=new r.PagesRouteModule({definition:{kind:l.x.PAGES,page:"/profile",pathname:"/profile",bundlePath:"",filename:""},components:{App:d.default,Document:n()},userland:c});s()}catch(e){s(e)}})},2820:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{default:()=>d});var r=a(997),l=a(2813),i=a(6252),o=a(7479),n=e([o]);function d(){return(0,r.jsxs)("div",{className:"app flex flex-col min-h-screen",children:[r.jsx(l.Z,{}),r.jsx("main",{className:"main-content flex-grow",children:r.jsx(o.Z,{})}),r.jsx(i.Z,{})]})}o=(n.then?(await n)():n)[0],s()}catch(e){s(e)}})},4861:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.d(t,{Z:()=>h});var r=a(997),l=a(6689),i=a(9332),o=a(6201),n=a(3146),d=a(3322),c=a(9314),u=e([o,n,d]);[o,n,d]=u.then?(await u)():u;let f=e=>{switch(e){case"\uD83D\uDD25":return"fires";case"\uD83D\uDC96":return"loves";case"\uD83D\uDE2D":return"sads";case"\uD83C\uDFAF":return"bullseyes";default:return""}},m=e=>{switch(e){case"fire":return"\uD83D\uDD25";case"heart":return"\uD83D\uDC96";case"cry":return"\uD83D\uDE2D";case"bullseye":return"\uD83C\uDFAF";default:return""}},h=({song:e,user:t,stats:a={},onDelete:s,onPublish:u,editableTitle:h,showStripeButton:g})=>{let x=(0,i.useRouter)(),[p,b]=(0,l.useState)({fires:a.fires||e.fires||0,loves:a.loves||e.loves||0,sads:a.sads||e.sads||0,bullseyes:a.bullseyes||e.bullseyes||0}),[y,v]=(0,l.useState)(a.jam_saves||e.jams||0),[j,w]=(0,l.useState)({fires:!1,loves:!1,sads:!1,bullseyes:!1}),[_,D]=(0,l.useState)(!1),[S,N]=(0,l.useState)(e.title),[C,k]=(0,l.useState)(!1),[F,P]=(0,l.useState)(e.genre_flavor||""),E=(0,l.useRef)(null),q=(0,l.useRef)(null),[$,O]=(0,l.useState)(!1),A=c.x[e.genre_flavor]||null,J=A?`ring-4 ring-${A.color}-500`:"";A&&A.color,(0,l.useEffect)(()=>{let e=new IntersectionObserver(([e])=>O(e.isIntersecting),{threshold:.5});return q.current&&e.observe(q.current),()=>e.disconnect()},[]),(0,l.useEffect)(()=>{E.current&&($?(E.current.play().catch(()=>{}),T()):E.current.pause())},[$]),(0,l.useEffect)(()=>{(async()=>{try{let[s,r]=await Promise.all([fetch(`/api/songs/${e.id}/stats`),t?fetch(`/api/reactions?user_id=${t.id}&song_id=${e.id}`):Promise.resolve({ok:!1})]),l={data:null};s.ok&&(l=await s.json());let i={data:[]};if(t&&r.ok&&(i=await r.json()),l.data&&(b({fires:a.fires||l.data.fires||0,loves:a.loves||l.data.loves||0,sads:a.sads||l.data.sads||0,bullseyes:a.bullseyes||l.data.bullseyes||0}),v(a.jam_saves||l.data.jams||0)),i.data?.length>0){let e={};for(let t of i.data)e[f(m(t.emoji))]=!0;w(e)}}catch(e){console.error("❌ Fetch stats/reactions error:",e)}})()},[t,e.id,a]);let T=async()=>{try{await fetch(`/api/songs/${e.id}/increment-view`,{method:"POST"})}catch(e){console.error("❌ View increment failed:",e)}},U=async()=>{if(h&&t?.id===e.artist_id)try{(await fetch(`/api/songs/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:S})})).ok?(o.default.success("Title updated!"),D(!1)):o.default.error("Failed to update title.")}catch(e){o.default.error("Failed to update title.")}},Z=async()=>{if(window.confirm("Are you sure you want to delete this song?"))try{(await fetch(`/api/songs/${e.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:t.id})})).ok?(o.default.success("Song deleted"),s&&s(e.id)):o.default.error("Error deleting song")}catch(e){o.default.error("Error deleting song")}},R=async()=>{if(!t||t.id!==e.artist_id)return;let a=!e.is_draft;try{(await fetch(`/api/songs/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_draft:a})})).ok?(o.default.success(`Song ${a?"set as draft":"published"}!`),u&&!a&&u(e.id)):o.default.error(`Failed to ${a?"set as draft":"publish"}`)}catch(e){o.default.error(`Failed to ${a?"set as draft":"publish"}`)}},I=async()=>{if(F!==e.genre_flavor&&t?.id===e.artist_id)try{(await fetch(`/api/songs/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({genre_flavor:F})})).ok?(o.default.success("Genre updated!"),k(!1)):o.default.error("Failed to update genre.")}catch(e){o.default.error("Failed to update genre.")}};return(0,r.jsxs)("div",{ref:q,"data-song-id":e.id,className:`bg-zinc-900 text-white w-full max-w-md mx-auto mb-10 p-4 rounded-xl shadow-md transition-all ${A?"hover:animate-genre-pulse":""} ${J}`,style:A?{boxShadow:`0 0 15px ${(e=>{switch(e){case"amber":return"#f59e0b";case"blue":return"#3b82f6";case"pink":return"#ec4899";case"purple":return"#a855f7";case"cyan":return"#06b6d4";case"red":return"#ef4444";default:return"#ffffff"}})(A.color)}`}:{},children:[(0,r.jsxs)("div",{className:"relative",children:[r.jsx("a",{href:`/artist/${e.artist_id}`,onClick:t=>{t.preventDefault(),T().finally(()=>{x.push(`/artist/${e.artist_id}`)})},className:"block",children:r.jsx("img",{src:e.cover,alt:e.title,className:"w-full h-auto rounded-xl mb-4"})}),A&&r.jsx("div",{className:`absolute top-2 left-2 bg-${A.color}-600 text-white text-xs font-bold px-2 py-1 rounded shadow`,children:A.label}),t&&(t.id===e.artist_id||e.is_jam)&&r.jsx("button",{onClick:Z,className:"absolute top-2 right-2 text-white bg-red-600 p-1 rounded-full hover:bg-red-700","aria-label":"Delete song",children:"\uD83D\uDDD1️"}),t&&t.id===e.artist_id&&r.jsx("button",{onClick:R,className:`absolute top-2 right-12 text-white p-1 rounded-full ${e.is_draft?"bg-green-600 hover:bg-green-700":"bg-yellow-600 hover:bg-yellow-700"}`,"aria-label":e.is_draft?"Publish song":"Set as draft",children:e.is_draft?"\uD83D\uDCE2 Publish":"⏸️ Draft"})]}),h&&t?.id===e.artist_id&&_?(0,r.jsxs)("div",{className:"mb-2",children:[r.jsx("input",{value:S,onChange:e=>N(e.target.value),className:"w-full p-1 bg-zinc-800 rounded text-white","aria-label":"Edit song title"}),r.jsx("button",{onClick:U,className:"text-sm text-green-400 mt-1","aria-label":"Save title",children:"Save"}),r.jsx("button",{onClick:()=>{D(!1),N(e.title)},className:"text-sm text-gray-400 mt-1 ml-2","aria-label":"Cancel edit",children:"Cancel"})]}):r.jsx("h2",{className:"text-xl font-semibold mb-1 cursor-pointer",onClick:()=>h&&t?.id===e.artist_id&&D(!0),children:S}),(0,r.jsxs)("p",{className:"bg-gray-800 text-white",children:["by ",e.artist]}),t?.id===e.artist_id&&r.jsx("div",{className:"mb-2",children:C?(0,r.jsxs)("div",{children:[r.jsx("select",{value:F,onChange:e=>P(e.target.value),className:"p-1 border rounded",children:Object.keys(c.x).map(e=>r.jsx("option",{value:e,children:c.x[e].label},e))}),r.jsx("button",{onClick:I,className:"ml-2 p-1 bg-blue-500 text-white rounded",children:"Save"}),r.jsx("button",{onClick:()=>k(!1),className:"ml-1 p-1 bg-gray-500 text-white rounded",children:"Cancel"})]}):r.jsx("button",{onClick:()=>k(!0),className:"p-1 bg-green-500 text-white rounded",children:"Edit Genre"})}),t&&r.jsx("div",{className:"mt-3 flex justify-center",children:r.jsx(d.Z,{songId:e.id,userId:t.id,artistId:e.artist_id})}),r.jsx("audio",{ref:E,src:e.audio,controls:!0,className:"w-full mb-3 mt-2"}),r.jsx(n.Z,{song:{...e,user_id:e.artist_id}})]})};s()}catch(e){s(e)}})},7479:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.d(t,{Z:()=>m});var r=a(997),l=a(6689),i=a(1842),o=a(2364),n=a(4861),d=a(6252),c=a(6201),u=e([n,c]);[n,c]=u.then?(await u)():u;let f={website:"\uD83C\uDF10",spotify:"\uD83C\uDFB5",youtube:"\uD83D\uDCFA",instagram:"\uD83D\uDCF8",soundcloud:"\uD83D\uDD0A",tiktok:"\uD83C\uDFAC",bandlab:"\uD83C\uDFB9"},m=()=>{let{user:e}=(0,o.a)(),t=(0,l.useRef)(),[a,s]=(0,l.useState)({}),[u,m]=(0,l.useState)([]),[h,g]=(0,l.useState)([]),[x,p]=(0,l.useState)({}),[b,y]=(0,l.useState)(null),[v,j]=(0,l.useState)(!1),[w,_]=(0,l.useState)(!1);(0,l.useEffect)(()=>{e?(D(),N(),C()):(s({}),m([]),g([]),p({}))},[e]);let D=async()=>{try{let{data:t,error:a}=await i.O.from("profiles").select("*").eq("id",e.id).single();if(a)throw a;s(t||{}),console.log("Profile Fetched:",t)}catch(e){c.default.error("Failed to load profile"),console.error("Profile Fetch Error:",e)}},S=async e=>{if(!e?.length){console.log("No song IDs for reaction stats");return}try{let[t,a,s]=await Promise.all([i.O.from("reactions").select("song_id, emoji").in("song_id",e),i.O.from("views").select("song_id").in("song_id",e),i.O.from("jamstacksongs").select("song_id").in("song_id",e)]),r={};e.forEach(e=>{r[e]={fires:0,loves:0,sads:0,bullseyes:0,views:0,jam_saves:0}}),t.data?.forEach(({song_id:e,emoji:t})=>{let a="fire"===t?"fires":"heart"===t?"loves":"cry"===t?"sads":"bullseyes";r[e][a]=(r[e][a]||0)+1}),a.data?.forEach(({song_id:e})=>{r[e].views=(r[e].views||0)+1}),s.data?.forEach(({song_id:e})=>{r[e].jam_saves=(r[e].jam_saves||0)+1}),p(r),console.log("Reaction Stats Fetched:",r)}catch(e){console.error("Reaction Stats Error:",e)}},N=async()=>{try{let{data:t,error:a}=await i.O.from("songs").select("id, title, artist, cover, audio, genre_flavor, is_draft, user_id, artist_id, created_at").eq("artist_id",e.id).order("created_at",{ascending:!1});if(a)throw a;m(t||[]),console.log("Uploads Fetched:",t),t?.length&&S(t.map(e=>e.id))}catch(e){c.default.error("Failed to load uploads"),console.error("Uploads Fetch Error:",e)}},C=async()=>{try{let{data:t,error:a}=await i.O.from("jamstacksongs").select("song_id, songs ( id, title, artist, cover, audio, genre_flavor, is_draft, user_id, artist_id, created_at )").eq("user_id",e.id);if(a)throw a;let s=t?.map(({songs:e,song_id:t})=>({...e,id:t||e.id,is_jam:!0}))||[];g(s),console.log("Jam Stack Fetched:",s),s.length&&S(s.map(e=>e.id))}catch(e){c.default.error("Failed to load Jam Stack"),console.error("Jam Stack Fetch Error:",e)}},k=(e,t)=>{s(a=>({...a,[e]:t}))},F=async()=>{try{let t={id:e.id,...a,updated_at:new Date().toISOString()},{error:s}=await i.O.from("profiles").upsert(t);if(s)throw s;c.default.success("Profile updated!"),y(null)}catch(e){c.default.error("Failed to save profile"),console.error("Profile Save Error:",e)}},P=async t=>{let a=t.target?.files?.[0];if(a){j(!0);try{let t=`${e.id}/avatar.png`,{error:r}=await i.O.storage.from("avatars").upload(t,a,{upsert:!0});if(r)throw r;let{data:l}=i.O.storage.from("avatars").getPublicUrl(t),o=`${l.publicUrl}?t=${Date.now()}`,{error:n}=await i.O.from("profiles").update({avatar_url:o}).eq("id",e.id);if(n)throw n;s(e=>({...e,avatar_url:o})),c.default.success("Avatar updated!")}catch(e){c.default.error("Failed to update avatar"),console.error("Avatar Upload Error:",e)}j(!1)}},E=async t=>{try{let{error:a}=await i.O.from("songs").delete().eq("id",t).eq("user_id",e.id);if(a)throw a;m(e=>e.filter(e=>e.id!==t)),c.default.success("Song deleted!")}catch(e){c.default.error("Failed to delete song"),console.error("Delete Song Error:",e)}},q=async t=>{try{let{error:a}=await i.O.from("songs").update({is_draft:!1}).eq("id",t).eq("user_id",e.id);if(a)throw a;c.default.success("Song published!"),N()}catch(e){c.default.error("Failed to publish song"),console.error("Publish Song Error:",e)}},$=async t=>{try{let{error:a}=await i.O.from("jamstacksongs").delete().eq("song_id",t).eq("user_id",e.id);if(a)throw a;g(e=>e.filter(e=>e.id!==t)),c.default.success("Song removed from Jam Stack!")}catch(e){c.default.error("Failed to remove Jam Stack song"),console.error("Delete Jam Error:",e)}},O=a.avatar_url||e?.user_metadata?.avatar_url||"/default-avatar.png";return(0,r.jsxs)("div",{className:"p-4 max-w-3xl mx-auto space-y-8 bg-gradient-to-b from-gray-100 to-gray-200 min-h-screen",children:[(0,r.jsxs)("div",{className:"relative bg-white rounded-2xl shadow-lg overflow-hidden",children:[r.jsx("div",{className:"h-32",style:{backgroundColor:"#3FD6CD"}}),r.jsx("div",{className:"relative flex flex-col items-center -mt-16",children:(0,r.jsxs)("div",{className:"relative",children:[r.jsx("img",{src:O,alt:"Profile Avatar",onClick:()=>!v&&t.current?.click(),className:`w-32 h-32 rounded-full object-cover border-4 border-white shadow-xl cursor-pointer hover:opacity-90 transition ${v?"opacity-50":""}`}),r.jsx("input",{type:"file",hidden:!0,ref:t,accept:"image/*",onChange:P,disabled:v}),v&&r.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded-full",children:r.jsx("span",{className:"text-white text-sm",children:"Uploading..."})})]})}),r.jsx("div",{className:"text-center mt-4",children:"name"===b?(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[r.jsx("input",{type:"text",value:a.display_name||"",onChange:e=>k("display_name",e.target.value),placeholder:"Your artist name",className:"text-2xl font-bold text-center border-b-2 border-blue-500 focus:outline-none focus:border-blue-700 bg-transparent w-64 sm:w-80",autoFocus:!0}),(0,r.jsxs)("div",{className:"flex gap-2 mt-3",children:[r.jsx("button",{onClick:F,className:"px-4 py-1 bg-blue-500 text-white rounded-full text-sm hover:bg-blue-600 transition",children:"Save"}),r.jsx("button",{onClick:()=>y(null),className:"px-4 py-1 bg-gray-200 text-gray-700 rounded-full text-sm hover:bg-gray-300 transition",children:"Cancel"})]})]}):(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:a.display_name||"Unnamed Artist"}),r.jsx("button",{onClick:()=>y("name"),className:"text-gray-500 hover:text-blue-500 transition","aria-label":"Edit display name",children:"✏️"})]})}),r.jsx("div",{className:"text-center max-w-md mx-auto mt-4 px-4",children:"bio"===b?(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[r.jsx("textarea",{value:a.bio||"",onChange:e=>k("bio",e.target.value),placeholder:"Tell your story...",rows:4,className:"w-full border rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-gray-700 resize-none",autoFocus:!0}),(0,r.jsxs)("div",{className:"flex gap-2 mt-3",children:[r.jsx("button",{onClick:F,className:"px-4 py-1 bg-blue-500 text-white rounded-full text-sm hover:bg-blue-600 transition",children:"Save"}),r.jsx("button",{onClick:()=>y(null),className:"px-4 py-1 bg-gray-200 text-gray-700 rounded-full text-sm hover:bg-gray-300 transition",children:"Cancel"})]})]}):(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2 text-gray-600",children:[r.jsx("p",{className:"text-sm italic",children:a.bio||"No bio yet. Click ✏️ to add one."}),r.jsx("button",{onClick:()=>y("bio"),className:"text-gray-500 hover:text-blue-500 transition","aria-label":"Edit bio",children:"✏️"})]})}),(0,r.jsxs)("div",{className:"text-center mt-6",children:[r.jsx("button",{onClick:()=>_(!w),className:"px-4 py-2 rounded-full bg-blue-100 text-blue-700 text-sm font-semibold hover:bg-blue-200 transition",children:w?"Hide Social Links":"Edit Social Links"}),w&&(0,r.jsxs)("div",{className:"mt-4 bg-white rounded-lg shadow p-4 max-w-md mx-auto",children:[r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:Object.keys(f).map(e=>(0,r.jsxs)("div",{className:"flex flex-col text-sm",children:[(0,r.jsxs)("label",{htmlFor:e,className:"mb-1 text-gray-700 flex items-center gap-1 capitalize",children:[r.jsx("span",{children:f[e]})," ",e]}),r.jsx("input",{id:e,value:a[e]||"",onChange:t=>k(e,t.target.value),placeholder:`Your ${e} URL`,className:"border border-gray-300 p-2 rounded focus:ring-2 focus:ring-blue-500 focus:outline-none text-gray-700"})]},e))}),r.jsx("button",{onClick:F,className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded-full text-sm hover:bg-blue-600 transition",children:"Save Social Links"})]})]})]}),u.length>0?(0,r.jsxs)("div",{children:[r.jsx("h2",{className:"text-xl font-bold mb-4 text-center",style:{color:"#3FD6CD"},children:"\uD83D\uDCE4 My Uploads"}),u.map(t=>(console.log("My Uploads Song:",{id:t.id,title:t.title,artist:a.display_name,user_id:e?.id,stats:x[t.id]||{},editableTitle:!0,showStripeButton:!a.stripe_account_id&&!t.is_draft,is_draft:t.is_draft}),r.jsx(n.Z,{song:{...t,artist:a.display_name},user:e,stats:x[t.id]||{},onDelete:()=>E(t.id),onPublish:t.is_draft?()=>q(t.id):void 0,editableTitle:!0,showStripeButton:!a.stripe_account_id&&!t.is_draft},t.id)))]}):r.jsx("p",{className:"text-center text-gray-500",children:"No uploads yet."}),h.length>0?(0,r.jsxs)("div",{children:[r.jsx("hr",{className:"my-6 border-t border-blue-500"}),r.jsx("h2",{className:"text-xl font-bold mb-4 text-center",style:{color:"#3FD6CD"},children:"\uD83C\uDFB5 My Jam Stack"}),r.jsx("hr",{className:"mb-6 border-t border-blue-500"}),h.map(t=>(console.log("My Jams Song:",{id:t.id,title:t.title,artist:t.artist||a.display_name,user_id:e?.id,stats:x[t.id]||{}}),r.jsx(n.Z,{song:{...t,artist:t.artist||a.display_name},user:e,stats:x[t.id]||{},onDelete:()=>$(t.id)},t.id)))]}):r.jsx("p",{className:"text-center text-gray-500",children:"No songs in your Jam Stack yet."}),r.jsx(d.Z,{})]})};s()}catch(e){s(e)}})},2885:e=>{e.exports=require("@supabase/supabase-js")},2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},1568:e=>{e.exports=require("zlib")},6201:e=>{e.exports=import("react-hot-toast")}};var t=require("../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[899,910,332,206],()=>a(8030));module.exports=s})();