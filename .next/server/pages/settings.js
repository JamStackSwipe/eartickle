(()=>{var e={};e.id=662,e.ids=[662,888,660],e.modules={665:(e,r,t)=>{"use strict";t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{config:()=>p,default:()=>h,getServerSideProps:()=>m,getStaticPaths:()=>g,getStaticProps:()=>x,reportWebVitals:()=>f,routeModule:()=>C,unstable_getServerProps:()=>v,unstable_getServerSideProps:()=>w,unstable_getStaticParams:()=>y,unstable_getStaticPaths:()=>b,unstable_getStaticProps:()=>D});var a=t(7093),l=t(5244),o=t(1323),i=t(2899),n=t.n(i),c=t(3414),u=t(4725),d=e([u]);u=(d.then?(await d)():d)[0];let h=(0,o.l)(u,"default"),x=(0,o.l)(u,"getStaticProps"),g=(0,o.l)(u,"getStaticPaths"),m=(0,o.l)(u,"getServerSideProps"),p=(0,o.l)(u,"config"),f=(0,o.l)(u,"reportWebVitals"),D=(0,o.l)(u,"unstable_getStaticProps"),b=(0,o.l)(u,"unstable_getStaticPaths"),y=(0,o.l)(u,"unstable_getStaticParams"),v=(0,o.l)(u,"unstable_getServerProps"),w=(0,o.l)(u,"unstable_getServerSideProps"),C=new a.PagesRouteModule({definition:{kind:l.x.PAGES,page:"/settings",pathname:"/settings",bundlePath:"",filename:""},components:{App:c.default,Document:n()},userland:u});s()}catch(e){s(e)}})},3414:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>l});var s=t(997);t(2636);var a=t(2364);let l=function({Component:e,pageProps:r}){return s.jsx(a.H,{children:s.jsx(e,{...r})})}},4725:(e,r,t)=>{"use strict";t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{default:()=>c});var a=t(997),l=t(2813),o=t(6252),i=t(1287),n=e([i]);function c(){return(0,a.jsxs)("div",{className:"app flex flex-col min-h-screen",children:[a.jsx(l.Z,{}),a.jsx("main",{className:"main-content flex-grow",children:a.jsx(i.Z,{})}),a.jsx(o.Z,{})]})}i=(n.then?(await n)():n)[0],s()}catch(e){s(e)}})},2364:(e,r,t)=>{"use strict";t.d(r,{H:()=>i,a:()=>n});var s=t(997),a=t(6689),l=t(1842);let o=(0,a.createContext)(),i=({children:e})=>{let[r,t]=(0,a.useState)(null),[i,n]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{l.O.auth.getSession().then(({data:{session:e}})=>{t(e?.user??null),n(!1)});let{data:e}=l.O.auth.onAuthStateChange((e,r)=>{t(r?.user??null)});return()=>{e?.subscription.unsubscribe()}},[]),s.jsx(o.Provider,{value:{user:r},children:!i&&e})},n=()=>{let e=(0,a.useContext)(o);if(!e)throw Error("useUser must be used within an AuthProvider");return e}},707:(e,r,t)=>{"use strict";t.d(r,{Z:()=>a});var s=t(997);t(6689);let a=({userId:e})=>{let r=async()=>{try{let r=await fetch("/api/create-connected-account",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e})}),t=await r.json().catch(()=>({}));if(!r.ok||!t.url)throw Error(t.error||"Stripe onboarding failed.");window.location.href=t.url}catch(e){console.error("❌ Stripe Connect Error:",e),alert(`Stripe Error: ${e.message}`)}};return s.jsx("button",{onClick:r,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"\uD83D\uDE80 Connect Stripe (Receive Tickles)"})}},6252:(e,r,t)=>{"use strict";t.d(r,{Z:()=>o});var s=t(997),a=t(1664),l=t.n(a);let o=()=>s.jsx("footer",{className:"w-full bg-black text-gray-400 text-xs py-4 px-4 text-center mt-auto",children:(0,s.jsxs)("div",{className:"space-x-3",children:[s.jsx(l(),{href:"/privacy",className:"hover:underline",children:"\uD83D\uDD12 Privacy"}),s.jsx(l(),{href:"/terms",className:"hover:underline",children:"\uD83D\uDCC4 Terms"}),s.jsx(l(),{href:"/about",className:"hover:underline",children:"\uD83D\uDCD6 About"}),s.jsx(l(),{href:"/flavors",className:"hover:underline",children:"\uD83C\uDFA8 Flavors"}),s.jsx("a",{href:"https://github.com/JamStackSwipe/eartickle/wiki",target:"_blank",rel:"noreferrer",className:"hover:underline",children:"\uD83D\uDCD8 Wiki"}),s.jsx("a",{href:"https://github.com/JamStackSwipe/eartickle",target:"_blank",rel:"noreferrer",className:"hover:underline",children:"\uD83D\uDD17 GitHub"})]})})},2813:(e,r,t)=>{"use strict";t.d(r,{Z:()=>u});var s=t(997),a=t(6689),l=t(1664),o=t.n(l),i=t(1163),n=t(1842),c=t(2364);let u=()=>{let{user:e}=(0,c.a)(),r=(0,i.useRouter)(),[t,l]=(0,a.useState)(!1),[u,d]=(0,a.useState)(!1),h=(0,a.useRef)(null),x=async()=>{await n.O.auth.signOut(),r.push("/login")},g=()=>{clearTimeout(h.current),l(!0)},m=()=>{h.current=setTimeout(()=>{l(!1)},300)};return(0,a.useEffect)(()=>()=>clearTimeout(h.current),[]),(0,s.jsxs)("header",{className:"w-full px-4 py-3 bg-black text-white flex justify-between items-center shadow relative z-10",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 cursor-pointer",onClick:()=>{r.push(e?"/swipe":"/login")},children:[s.jsx("img",{src:"/logo-icon.png",alt:"EarTickle Icon",className:"w-8 h-8 object-contain"}),(0,s.jsxs)("div",{className:"flex flex-col",children:[s.jsx("div",{className:"text-xl font-bold text-white hover:text-gray-300",children:"Ear Tickle"}),s.jsx("div",{className:"text-xs text-gray-400 -mt-1 ml-1",children:"Scroll. Stack. Play."})]})]}),e&&(0,s.jsxs)("nav",{className:"flex items-center space-x-4 text-sm relative",children:[(0,s.jsxs)("div",{className:"hidden sm:flex items-center space-x-4",children:[s.jsx(o(),{href:"/swipe",className:"hover:underline text-white",children:"Swipe"}),s.jsx(o(),{href:"/jamstack",className:"hover:underline text-white",children:"\uD83C\uDFB6 JamStack"}),s.jsx(o(),{href:"/charts",className:"hover:underline text-white",children:"\uD83D\uDCC8 Charts"}),s.jsx(o(),{href:"/rewards",className:"hover:underline text-white",children:"\uD83C\uDF81 Rewards"}),s.jsx(o(),{href:"/upload",className:"hover:underline text-white",children:"Upload"})]}),(0,s.jsxs)("div",{className:"relative hidden sm:block",onMouseEnter:g,onMouseLeave:m,children:[s.jsx("img",{src:e.user_metadata?.avatar_url||"/default-avatar.png",alt:"avatar",onClick:()=>l(!t),className:"w-8 h-8 rounded-full border border-white cursor-pointer"}),t&&(0,s.jsxs)("div",{onMouseEnter:g,onMouseLeave:m,className:"absolute right-0 mt-2 w-48 bg-white text-black rounded shadow-lg text-sm overflow-hidden z-[9999]",children:[s.jsx(o(),{href:"/profile",className:"block px-4 py-2 hover:bg-gray-100",children:"\uD83D\uDC64 My Profile"}),s.jsx(o(),{href:`/artist/${e.id}`,className:"block px-4 py-2 hover:bg-gray-100",children:"\uD83C\uDFA4 My Artist Page"}),s.jsx(o(),{href:"/settings",className:"block px-4 py-2 hover:bg-gray-100",children:"⚙️ Settings"}),s.jsx(o(),{href:"/privacy",className:"block px-4 py-2 hover:bg-gray-100",children:"\uD83D\uDD12 Privacy"}),s.jsx(o(),{href:"/terms",className:"block px-4 py-2 hover:bg-gray-100",children:"\uD83D\uDCC4 Terms"}),s.jsx("button",{onClick:x,className:"w-full text-left px-4 py-2 hover:bg-gray-100",children:"\uD83D\uDEAA Logout"})]})]}),s.jsx("div",{className:"sm:hidden",children:s.jsx("button",{onClick:()=>d(!u),className:"focus:outline-none",children:"☰"})})]}),u&&s.jsx("div",{className:"absolute top-full right-0 w-full bg-black text-white sm:hidden z-50 mt-2 shadow-lg rounded",children:(0,s.jsxs)("div",{className:"flex flex-col px-4 py-2 space-y-2 text-sm",children:[s.jsx(o(),{href:"/swipe",onClick:()=>d(!1),children:"Swipe"}),s.jsx(o(),{href:"/upload",onClick:()=>d(!1),children:"Upload"}),s.jsx(o(),{href:"/jamstack",onClick:()=>d(!1),children:"\uD83C\uDFB6 JamStack"}),s.jsx(o(),{href:"/rewards",onClick:()=>d(!1),children:"\uD83C\uDF81 Rewards"}),s.jsx(o(),{href:"/charts",onClick:()=>d(!1),children:"\uD83D\uDCC8 Charts"}),s.jsx(o(),{href:"/profile",onClick:()=>d(!1),children:"\uD83D\uDC64 My Profile"}),s.jsx(o(),{href:`/artist/${e.id}`,onClick:()=>d(!1),children:"\uD83C\uDFA4 My Artist Page"}),s.jsx(o(),{href:"/settings",onClick:()=>d(!1),children:"⚙️ Settings"}),s.jsx(o(),{href:"/privacy",onClick:()=>d(!1),children:"\uD83D\uDD12 Privacy"}),s.jsx(o(),{href:"/terms",onClick:()=>d(!1),children:"\uD83D\uDCC4 Terms"}),s.jsx("button",{onClick:()=>{x(),d(!1)},children:"\uD83D\uDEAA Logout"})]})})]})}},1287:(e,r,t)=>{"use strict";t.a(e,async(e,s)=>{try{t.d(r,{Z:()=>h});var a=t(997),l=t(6689),o=t(4661),i=t(1842),n=t(707),c=t(6201),u=e([c]);c=(u.then?(await u)():u)[0];let d=[{value:"country_roots",label:"Country & Roots \uD83E\uDD20"},{value:"hiphop_flow",label:"Hip-Hop & Flow \uD83C\uDFA4"},{value:"rock_raw",label:"Rock & Raw \uD83E\uDD18"},{value:"pop_shine",label:"Pop & Shine ✨"},{value:"spiritual_soul",label:"Spiritual & Soul ✝️"},{value:"comedy_other",label:"Comedy & Other \uD83D\uDE02"}],h=()=>{let e=(0,o.useNavigate)(),[r,t]=(0,l.useState)(null),[s,u]=(0,l.useState)(null),[h,x]=(0,l.useState)([]),[g,m]=(0,l.useState)([]),[p,f]=(0,l.useState)([]);(0,l.useEffect)(()=>{(async()=>{try{let{data:e,error:r}=await i.O.auth.getUser();if(r)throw r;if(e?.user){let{id:r,email:s}=e.user;t(r),u(s),D(r),b(r),y(r)}}catch(e){console.error("❌ Error fetching user:",e),c.default.error("Failed to load user data")}})()},[]);let D=async e=>{try{let{data:r,error:t}=await i.O.from("profiles").select("preferred_genres").eq("id",e).maybeSingle();if(t)throw t;r?.preferred_genres&&x(r.preferred_genres)}catch(e){console.error("❌ Error fetching preferences:",e)}},b=async e=>{try{let{data:r,error:t}=await i.O.from("tickles").select("song_id").eq("user_id",e);if(t)throw t;m(r||[])}catch(e){console.error("❌ Error fetching sent tickles:",e)}},y=async e=>{try{let{data:r,error:t}=await i.O.from("songs").select("id").eq("user_id",e);if(t)throw t;f(r||[])}catch(e){console.error("❌ Error fetching songs:",e)}},v=e=>{x(r=>r.includes(e)?r.filter(r=>r!==e):[...r,e])},w=async()=>{try{let{error:e}=await i.O.from("profiles").update({preferred_genres:h}).eq("id",r);if(e)throw e;c.default.success("Genre Flavors saved!")}catch(e){console.error("❌ Error saving genres:",e),c.default.error("Failed to save genres")}},C=async()=>{try{let{error:r}=await i.O.auth.signOut();if(r)throw r;c.default.success("Logged out successfully"),e("/")}catch(e){console.error("❌ Logout error:",e),c.default.error("Failed to log out: "+e.message)}},j=async()=>{if(window.confirm("Are you sure you want to permanently delete your account?"))try{let{error:r}=await i.O.rpc("delete_user");if(r)throw r;await i.O.auth.signOut(),c.default.success("Account deleted successfully"),e("/")}catch(e){console.error("❌ Delete account error:",e),c.default.error("Error deleting account: "+e.message)}},k=async()=>{if(!s){c.default.error("No email found for user");return}try{let{error:e}=await i.O.auth.resetPasswordForEmail(s,{redirectTo:`${window.location.origin}/profile`});if(e)throw e;c.default.success("Password reset link sent to your email")}catch(e){console.error("❌ Password reset error:",e),c.default.error("Error sending password reset: "+e.message)}};return(0,a.jsxs)("div",{className:"p-6 max-w-2xl mx-auto bg-gradient-to-b from-gray-100 to-gray-200 min-h-screen",children:[a.jsx("h1",{className:"text-3xl font-bold text-[#3FD6CD] mb-6 text-center",children:"Settings"}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6 space-y-6",children:[r&&(0,a.jsxs)("div",{className:"bg-gray-50 text-sm p-4 rounded-lg text-gray-800",children:[a.jsx("strong",{className:"flex items-center gap-1",children:"\uD83D\uDD10 User ID:"}),a.jsx("code",{className:"block break-all mt-1",children:r})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[a.jsx("button",{onClick:k,className:"w-full px-4 py-2 text-white rounded-lg hover:shadow-md transition",style:{backgroundColor:"#3FD6CD"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#2CB9B0",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#3FD6CD",children:"\uD83D\uDD12 Reset Password"}),a.jsx("button",{onClick:j,className:"w-full px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition",children:"❌ Delete My Account"}),a.jsx("button",{onClick:C,className:"w-full px-4 py-2 text-white rounded-lg hover:shadow-md transition",style:{backgroundColor:"#3FD6CD"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#2CB9B0",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#3FD6CD",children:"\uD83D\uDEAA Logout"})]}),a.jsx("hr",{className:"my-6 border-t border-[#3FD6CD]"}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\uD83C\uDFB5 Favorite Genre Flavors"}),0===d.length?a.jsx("p",{className:"text-gray-500 text-sm",children:"No genre flavors available yet."}):(0,a.jsxs)(a.Fragment,{children:[a.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:d.map(e=>a.jsx("button",{onClick:()=>v(e.value),className:`px-3 py-1 rounded-full border text-sm transition ${h.includes(e.value)?"bg-[#3FD6CD] text-white border-[#3FD6CD]":"bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200"}`,children:e.label},e.value))}),a.jsx("button",{onClick:w,className:"w-full px-4 py-2 text-white rounded-lg hover:shadow-md transition",style:{backgroundColor:"#3FD6CD"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#2CB9B0",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#3FD6CD",children:"\uD83D\uDCBE Save Preferences"})]})]}),a.jsx("hr",{className:"my-6 border-t border-[#3FD6CD]"}),p?.length>0&&(0,a.jsxs)("div",{children:[a.jsx("h2",{className:"text-lg font-semibold text-[#3FD6CD] mb-3",children:"\uD83D\uDCB8 Artist Payments"}),a.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Connect your Stripe account to receive gifts (Tickles) from fans."}),a.jsx(n.Z,{userId:r,email:s})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Want to share your artist profile?"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-white border border-gray-200 rounded-lg p-2",children:[a.jsx("input",{readOnly:!0,value:`${window.location.origin}/artist/${r}`,className:"flex-1 bg-transparent outline-none text-gray-700 text-sm",onClick:e=>e.target.select()}),a.jsx("button",{onClick:()=>{navigator.clipboard.writeText(`${window.location.origin}/artist/${r}`),c.default.success("Profile link copied!")},className:"px-3 py-1 text-white rounded-lg text-xs hover:shadow-md transition",style:{backgroundColor:"#3FD6CD"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#2CB9B0",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#3FD6CD",children:"Copy"})]})]})]})]})};s()}catch(e){s(e)}})},1842:(e,r,t)=>{"use strict";t.d(r,{O:()=>o});var s=t(2885);let a=process.env.REACT_APP_SUPABASE_URL,l=process.env.REACT_APP_SUPABASE_KEY;if(console.log("Supabase URL:",a),console.log("Supabase Key:",l?"Set (hidden)":"undefined"),!a)throw Error("Supabase URL is required");if(!l)throw Error("Supabase Key is required");let o=(0,s.createClient)(a,l,{global:{headers:{Accept:"application/json"}}})},2636:()=>{},2885:e=>{"use strict";e.exports=require("@supabase/supabase-js")},2785:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{"use strict";e.exports=require("react")},6405:e=>{"use strict";e.exports=require("react-dom")},4661:e=>{"use strict";e.exports=require("react-router-dom")},997:e=>{"use strict";e.exports=require("react/jsx-runtime")},2048:e=>{"use strict";e.exports=require("fs")},5315:e=>{"use strict";e.exports=require("path")},6162:e=>{"use strict";e.exports=require("stream")},1568:e=>{"use strict";e.exports=require("zlib")},6201:e=>{"use strict";e.exports=import("react-hot-toast")}};var r=require("../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[899,910],()=>t(665));module.exports=s})();