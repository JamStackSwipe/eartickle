"use strict";(()=>{var e={};e.id=695,e.ids=[695,660],e.modules={5058:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{config:()=>x,default:()=>f,getServerSideProps:()=>h,getStaticPaths:()=>g,getStaticProps:()=>m,reportWebVitals:()=>p,routeModule:()=>j,unstable_getServerProps:()=>v,unstable_getServerSideProps:()=>y,unstable_getStaticParams:()=>w,unstable_getStaticPaths:()=>D,unstable_getStaticProps:()=>b});var a=t(7093),o=t(5244),l=t(1323),n=t(2899),i=t.n(n),c=t(3414),u=t(7412),d=e([u]);u=(d.then?(await d)():d)[0];let f=(0,l.l)(u,"default"),m=(0,l.l)(u,"getStaticProps"),g=(0,l.l)(u,"getStaticPaths"),h=(0,l.l)(u,"getServerSideProps"),x=(0,l.l)(u,"config"),p=(0,l.l)(u,"reportWebVitals"),b=(0,l.l)(u,"unstable_getStaticProps"),D=(0,l.l)(u,"unstable_getStaticPaths"),w=(0,l.l)(u,"unstable_getStaticParams"),v=(0,l.l)(u,"unstable_getServerProps"),y=(0,l.l)(u,"unstable_getServerSideProps"),j=new a.PagesRouteModule({definition:{kind:o.x.PAGES,page:"/swipe",pathname:"/swipe",bundlePath:"",filename:""},components:{App:c.default,Document:i()},userland:u});s()}catch(e){s(e)}})},7412:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{default:()=>c});var a=t(997),o=t(2813),l=t(6252),n=t(607),i=e([n]);function c(){return(0,a.jsxs)("div",{className:"app flex flex-col min-h-screen",children:[a.jsx(o.Z,{}),a.jsx("main",{className:"main-content flex-grow",children:a.jsx(n.Z,{})}),a.jsx(l.Z,{})]})}n=(i.then?(await i)():i)[0],s()}catch(e){s(e)}})},3510:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.d(r,{Z:()=>h});var a=t(997),o=t(6689),l=t(9332),n=t(1842),i=t(6201),c=t(3146),u=t(3322),d=t(9314),f=e([i,c,u]);[i,c,u]=f.then?(await f)():f,new Audio("/sounds/tickle.mp3");let m=e=>{switch(e){case"\uD83D\uDD25":return"fires";case"\uD83D\uDC96":return"loves";case"\uD83D\uDE2D":return"sads";case"\uD83C\uDFAF":return"bullseyes";default:return""}},g=e=>{switch(e){case"fire":return"\uD83D\uDD25";case"heart":return"\uD83D\uDC96";case"cry":return"\uD83D\uDE2D";case"bullseye":return"\uD83C\uDFAF";default:return""}},h=({song:e,user:r})=>{if(e.is_draft||!e.cover||!e.audio)return null;let t=(0,l.useRouter)(),[s,i]=(0,o.useState)({fires:e.fires||0,loves:e.loves||0,sads:e.sads||0,bullseyes:e.bullseyes||0}),[f,h]=(0,o.useState)({fires:!1,loves:!1,sads:!1,bullseyes:!1}),x=(0,o.useRef)(null),p=(0,o.useRef)(null),[b,D]=(0,o.useState)(!1),w=d.x[e.genre_flavor]||null,v=w?`ring-4 ring-${w.color}-500`:"";w&&w.color,(0,o.useEffect)(()=>{let e=new IntersectionObserver(([e])=>D(e.isIntersecting),{threshold:.5});return p.current&&e.observe(p.current),()=>e.disconnect()},[]),(0,o.useEffect)(()=>{x.current&&(b?(x.current.play().catch(()=>{}),y()):x.current.pause())},[b]),(0,o.useEffect)(()=>{(async()=>{try{let[t,s]=await Promise.all([n.O.from("songs").select("fires, loves, sads, bullseyes, jams").eq("id",e.id).single(),r?n.O.from("reactions").select("emoji").eq("user_id",r.id).eq("song_id",e.id):{data:[]}]);if(t.data&&i({fires:t.data.fires||0,loves:t.data.loves||0,sads:t.data.sads||0,bullseyes:t.data.bullseyes||0}),s.data?.length>0){let e={};for(let r of s.data)e[m(g(r.emoji))]=!0;h(e)}}catch(e){console.error("❌ Stats/reactions fetch error:",e)}})()},[r,e.id]);let y=async()=>{try{await n.O.rpc("increment_song_view",{song_id_input:e.id})}catch(e){console.error("❌ View increment error:",e)}};return(0,a.jsxs)("div",{ref:p,"data-song-id":e.id,className:`bg-zinc-900 text-white w-full max-w-md mx-auto mb-10 p-4 rounded-xl shadow-md transition-all ${w?"hover:animate-genre-pulse":""} ${v}`,style:w?{boxShadow:`0 0 15px ${(e=>{switch(e){case"amber":return"#f59e0b";case"blue":return"#3b82f6";case"pink":return"#ec4899";case"purple":return"#a855f7";case"cyan":return"#06b6d4";case"red":return"#ef4444";default:return"#ffffff"}})(w.color)}`}:{},children:[(0,a.jsxs)("div",{className:"relative",children:[a.jsx("a",{href:`/artist/${e.artist_id}`,onClick:r=>{r.preventDefault(),y().finally(()=>{t.push(`/artist/${e.artist_id}`)})},className:"block",children:a.jsx("img",{src:e.cover,alt:e.title,className:"w-full h-auto rounded-xl mb-4"})}),w&&a.jsx("div",{className:`absolute top-2 left-2 bg-${w.color}-600 text-white text-xs font-bold px-2 py-1 rounded shadow`,children:w.label})]}),a.jsx("h2",{className:"text-xl font-semibold mb-1",children:e.title}),(0,a.jsxs)("p",{className:"text-sm text-gray-400 mb-2",children:["by ",e.artist]}),r&&a.jsx("div",{className:"mt-3 flex justify-center",children:a.jsx(u.Z,{songId:e.id,userId:r.id})}),a.jsx("audio",{ref:x,src:e.audio,controls:!0,className:"w-full mb-3 mt-2"}),a.jsx(c.Z,{song:{...e,user_id:e.artist_id}})]})};s()}catch(e){s(e)}})},607:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.d(r,{Z:()=>d});var a=t(997),o=t(6689),l=t(2364),n=t(7697),i=t(3510),c=t(9314),u=e([i]);i=(u.then?(await u)():u)[0];let d=()=>{let{user:e}=(0,l.a)(),[r,t]=(0,o.useState)([]),[s,u]=(0,o.useState)(null),[d,f]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{e&&(0,n.z)(e.id).then(e=>{console.log("All Songs from Engine:",e.map(e=>({id:e.id,genre_flavor:e.genre_flavor,score:e.score})));let r=s?e.filter(e=>e.genre_flavor.toLowerCase()===s.toLowerCase()):e;console.log("Filtered Songs for",s||"All:",r.map(e=>({id:e.id,genre_flavor:e.genre_flavor,score:e.score}))),t(r)}).catch(console.error)},[e,s]),(0,a.jsxs)("div",{className:"p-4 min-h-screen",children:[a.jsx("h1",{className:"text-2xl font-bold mb-4 text-center",style:{color:"#3FD6CD"},children:"Discover Songs"}),a.jsx("div",{className:"flex justify-center mb-6",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>f(!d),className:"bg-white border-l-4 p-2 rounded-lg shadow-md hover:shadow-lg transition-all flex items-center",style:{borderColor:"#3FD6CD",color:"#3FD6CD"},children:[a.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 6h16M4 12h16m-7 6h7"})}),a.jsx("span",{className:"ml-2",children:s&&c.x[s]?.label||"All"})]}),d&&(0,a.jsxs)("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-white rounded-lg shadow-lg z-10",children:[a.jsx("button",{onClick:()=>{u(null),f(!1)},className:"block w-full text-left p-2 hover:bg-gray-100 rounded-t-lg",children:"All"}),Object.keys(c.x).map(e=>(0,a.jsxs)("button",{onClick:()=>{u(e),f(!1)},className:"block w-full text-left p-2 hover:bg-gray-100",style:{borderLeftColor:c.x[e].color+"-600",color:c.x[e].color+"-800"},children:[c.x[e].emoji," ",c.x[e].label]},e))]})]})}),r.length>0?r.map(r=>a.jsx(i.Z,{song:r,user:e},r.id)):a.jsx("p",{className:"text-center text-gray-500",children:"No songs to discover in this genre yet."})]})};s()}catch(e){s(e)}})},7697:(e,r,t)=>{t.d(r,{z:()=>a});var s=t(1842);async function a(e){let r,t,a,o;try{let{data:e,error:t}=await s.O.from("songs").select("*").neq("audio",null).order("created_at",{ascending:!1});if(t||!e)return console.error("Song fetch error:",t),[];r=e}catch(e){return console.error("Song fetch failed:",e),[]}console.log("Raw songs fetched:",r.length),console.log("Raw songs genres:",r.map(e=>e.genre_flavor));try{let{data:r,error:a}=await s.O.from("profiles").select("preferred_genres").eq("id",e).maybeSingle();a&&console.error("Profile fetch error:",a),t=r}catch(e){console.error("Profile fetch failed:",e),t=null}try{let{data:r,error:t}=await s.O.from("jamstacksongs").select("song_id").eq("user_id",e);t&&console.error("Jams fetch error:",t),a=r||[]}catch(e){console.error("Jams fetch failed:",e),a=[]}try{let{data:r,error:t}=await s.O.from("tickles").select("song_id").eq("user_id",e);t?(console.warn("Tickles fetch failed, using empty data:",t),o=[]):o=r||[]}catch(e){console.warn("Tickles fetch failed, using empty data:",e),o=[]}let l=await Promise.all(r.map(async r=>{let l,n,i=0,c=new Date,u=new Date(r.created_at||c),d=(c-u)/864e5;a.some(e=>e.song_id===r.id)&&(i+=10),o.some(e=>e.song_id===r.id)&&(i+=25),t?.preferred_genres?.includes(r.genre)&&(i+=5),i+=d<7?50/(d+1):0;try{let{data:e,error:t}=await s.O.from("tickles").select("emoji").eq("song_id",r.id);t&&console.warn(`Tickles error for song ${r.id}:`,t),l=e||[]}catch(e){console.warn(`Tickles error for song ${r.id}:`,e),l=[]}let f={"❤️":0,"\uD83D\uDD25":0,"\uD83D\uDE22":0,"\uD83C\uDFAF":0};l.forEach(e=>{void 0!==f[e.emoji]&&f[e.emoji]++});try{let{count:e,error:t}=await s.O.from("jamstacksongs").select("*",{count:"exact",head:!0}).eq("song_id",r.id);t&&console.error("Jam count error:",t),n=e||0}catch(e){console.error("Jam count failed:",e),n=0}i+=2*f["❤️"]+3*f["\uD83D\uDD25"]+f["\uD83D\uDE22"]+4*f["\uD83C\uDFAF"]+2*(n||0)+0;try{let{error:t}=await s.O.from("songs").update({score:i}).eq("id",r.id).eq("user_id",e).select();if(t)throw t}catch(e){console.error(`Score update error for song ${r.id}:`,e)}return{...r,score:i,likes:f["❤️"],fires:f["\uD83D\uDD25"],sads:f["\uD83D\uDE22"],bullseyes:f["\uD83C\uDFAF"],jams:n||0,boosts:0,views:r.views||0}}));for(let e=l.length-1;e>0;e--){let r=Math.floor(Math.random()*(e+1));[l[e],l[r]]=[l[r],l[e]]}return l.sort((e,r)=>r.score-e.score)}},2885:e=>{e.exports=require("@supabase/supabase-js")},2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},1568:e=>{e.exports=require("zlib")},6201:e=>{e.exports=import("react-hot-toast")}};var r=require("../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[899,910,332,206],()=>t(5058));module.exports=s})();